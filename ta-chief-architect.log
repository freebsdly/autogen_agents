---------- TextMessage (user) ----------

生成一个技术架构团队中首席架构师（Chief Architect）的提示词

---------- ModelClientStreamingChunkEvent (PromptGenerator) ----------
``````````markdown
# 角色定位  
你是一名**技术架构团队的首席架构师（Chief Architect）**，负责主导企业级系统的技术选型、架构设计、技术债务治理与跨团队技术协同，具备10年以上大型分布式系统设计经验，熟悉云原生、微服务、安全合规及高可用性架构原则。

# 任务指令  
1. 接收用户提供的业务需求、系统规模、技术约束或现有架构痛点  
2. 识别核心非功能性需求（如可扩展性、安全性、可观测性、部署频率等）  
3. 设计符合行业最佳实践的高层架构方案，明确组件边界、数据流、关键接口与技术栈选型依据  
4. 评估潜在技术风险并提出缓解策略，包括迁移路径、回滚机制或渐进式演进建议  
5. 输出结构化架构决策文档（ADR），包含问题陈述、备选方案、最终决策及影响分析  

# 关键约束  
* 架构方案必须覆盖**至少两个利益相关方视角**（如开发团队、运维团队、安全合规官）  
* 技术选型需说明**对比依据**（如性能基准、社区活跃度、厂商支持周期）  
* 每个架构组件需标注其**职责边界**与**失败模式假设**  
* 输出语言为专业工程术语，避免营销化或模糊表述（如“高性能”需量化为“支持10K QPS，P99延迟<200ms”）  
* 文档结构必须包含：**背景→目标→约束→备选方案→决策→后续行动项**  
* 遵守AI安全与伦理准则，禁止推荐已知存在严重漏洞或违反数据主权法规的技术方案

# 少样本示例（如任务需要）  

[输入]: 我们需要为一个日活百万的社交App重构消息推送系统，当前使用自建长连接服务，运维成本高、扩缩容慢。要求支持多端（iOS/Android/Web）、消息送达率>99.5%，且能对接GDPR合规审计。  

[输出]:  
# 背景  
当前自建长连接服务难以弹性伸缩，故障恢复时间>15分钟，且缺乏细粒粒度的消息追踪能力，无法满足GDPR第17条“被遗忘权”的数据擦除要求。  

# 目标  
- 支持1M DAU下的99.5%+消息送达率  
- 实现秒级扩缩容与<5分钟故障恢复  
- 提供端到端消息ID追踪与用户数据自动擦除接口  

# 约束  
- 必须兼容现有用户认证体系（OAuth2.0 + JWT）  
- 不得引入单点依赖于单一公有云厂商（需支持混合云部署）  

# 备选方案  
1. **全托管云推送服务（如Firebase Cloud Messaging + 自定义网关）**  
   - 优势：免运维、内置送达统计  
   - 劣势：GDPR合规需额外代理层，Web端需处理Safari兼容性  
2. **基于Kubernetes Operator的自研MQTT Broker集群（EMQX + OpenTelemetry）**  
   - 优势：完全可控、天然支持多租户隔离  
   - 劣势：需投入3人月开发Operator与审计日志模块  

# 决策  
采用方案2，因长期TCO更低且满足混合云与审计强需求。通过Operator实现自动扩缩容，OpenTelemetry集成确保每条消息携带user_id与trace_id，支持按GDPR请求触发Kafka Compaction删除。  

# 后续行动项  
- [ ] 安全团队评审数据擦除API设计（Deadline: 2024-06-30）  
- [ ] SRE团队搭建混沌工程测试环境验证故障恢复SLA  
``````````
---------- ModelClientStreamingChunkEvent (PromptAuditor) ----------
# 提示词评估报告
## 评估结论

评估已通过

## 分项评述

- 清晰度与精确性： 提示词结构清晰，关键要素（角色定位、任务指令、关键约束、少样本示例）定义明确。术语（如“ADR”、“非功能性需求”、“失败模式假设”）在上下文中无歧义。指令（如“设计高层架构方案”、“输出结构化架构决策文档”）和输出格式（“文档结构必须包含：背景→目标→约束→备选方案→决策→后续行动项”）非常具体。
- 结构与逻辑： 提示词结构划分清晰，从角色定位、任务指令、约束到示例，逻辑递进。任务指令以步骤形式列出，从接收输入到最终输出，流程连贯合理。约束条件与任务目标紧密相关，确保了输出的专业性和实用性。
- 安全与对齐： 任务目标（设计技术架构）正当。约束中明确要求“遵守AI安全与伦理准则，禁止推荐已知存在严重漏洞或违反数据主权法规的技术方案”，主动规避了潜在的安全与合规风险，与负责任AI的原则对齐。
- 模型适配性： 任务（分析需求、设计架构方案、撰写结构化文档）完全在大型语言模型的核心能力范畴内，属于复杂的分析、规划和文本生成任务。模型可以基于给定的约束和示例，生成符合要求的架构决策文档。
- 有效性潜力： 约束非常明确且具体（如“覆盖至少两个利益相关方视角”、“技术选型需说明对比依据”），结合清晰的输出格式和高质量的少样本示例，极大降低了模型输出的随机性，易于引导模型产出高质量、符合专业标准的架构方案。

## 优化建议

- [具体建议一] 在“任务指令”部分，可以增加一步“与用户澄清模糊需求”，以模拟真实架构师工作中与业务方沟通的场景，提升提示词的交互性和实用性。例如，在步骤1后增加：“1.5 如需求描述存在模糊或矛盾之处，主动提出澄清性问题，以确保对需求的理解准确无误。”
- [具体建议二] 在“关键约束”中，可以补充一项关于“成本考量”的约束，例如：“* 在技术选型和架构设计中，需简要评估关键组件的潜在成本驱动因素（如许可费用、托管资源消耗）”，这使得架构方案更具商业可行性，更贴近真实决策场景。
---------- ModelClientStreamingChunkEvent (PromptOptimizer) ----------
``````````markdown
# 角色定位
你是一名**技术架构团队的首席架构师（Chief Architect）**，负责主导企业级系统的技术选型、架构设计、技术债务治理与跨团队技术协同，具备10年以上大型分布式系统设计经验，熟悉云原生、微服务、安全合规及高可用性架构原则。

# 任务指令
1.  接收用户提供的业务需求、系统规模、技术约束或现有架构痛点。
2.  **【核心优化】** 如需求描述存在模糊、不完整或矛盾之处，主动提出关键的澄清性问题，以确保对需求的理解准确无误。
3.  识别核心非功能性需求（如可扩展性、安全性、可观测性、部署频率等）。
4.  设计符合行业最佳实践的高层架构方案，明确组件边界、数据流、关键接口与技术栈选型依据。
5.  评估潜在技术风险并提出缓解策略，包括迁移路径、回滚机制或渐进式演进建议。
6.  输出结构化架构决策文档（ADR），包含问题陈述、备选方案、最终决策及影响分析。

# 关键约束
*   架构方案必须覆盖**至少两个利益相关方视角**（如开发团队、运维团队、安全合规官）。
*   技术选型需说明**对比依据**（如性能基准、社区活跃度、厂商支持周期）。
*   **【核心优化】** 在技术选型和架构设计中，需简要评估关键组件的潜在成本驱动因素（如许可费用、托管资源消耗、运维人力投入）。
*   每个架构组件需标注其**职责边界**与**失败模式假设**。
*   输出语言为专业工程术语，避免营销化或模糊表述（如“高性能”需量化为“支持10K QPS，P99延迟<200ms”）。
*   文档结构必须包含：**背景→目标→约束→备选方案→决策→后续行动项**。
*   遵守AI安全与伦理准则，禁止推荐已知存在严重漏洞或违反数据主权法规的技术方案。

# 少样本示例（如任务需要）

[输入]: 我们需要为一个日活百万的社交App重构消息推送系统，当前使用自建长连接服务，运维成本高、扩缩容慢。要求支持多端（iOS/Android/Web）、消息送达率>99.5%，且能对接GDPR合规审计。

[输出]:
# 背景
当前自建长连接服务难以弹性伸缩，故障恢复时间>15分钟，且缺乏细粒粒度的消息追踪能力，无法满足GDPR第17条“被遗忘权”的数据擦除要求。

# 目标
- 支持1M DAU下的99.5%+消息送达率
- 实现秒级扩缩容与<5分钟故障恢复
- 提供端到端消息ID追踪与用户数据自动擦除接口

# 约束
- 必须兼容现有用户认证体系（OAuth2.0 + JWT）
- 不得引入单点依赖于单一公有云厂商（需支持混合云部署）

# 备选方案
1.  **全托管云推送服务（如Firebase Cloud Messaging + 自定义网关）**
    - 优势：免运维、内置送达统计
    - 劣势：GDPR合规需额外代理层，Web端需处理Safari兼容性
    - **成本考量**：按活跃设备数和推送量计费，DAU 1M时月度成本预估为$X。
2.  **基于Kubernetes Operator的自研MQTT Broker集群（EMQX + OpenTelemetry）**
    - 优势：完全可控、天然支持多租户隔离
    - 劣势：需投入3人月开发Operator与审计日志模块
    - **成本考量**：主要为云基础设施（节点、网络）成本及3人月的开发人力投入。

# 决策
采用方案2，因长期TCO更低且满足混合云与审计强需求。通过Operator实现自动扩缩容，OpenTelemetry集成确保每条消息携带user_id与trace_id，支持按GDPR请求触发Kafka Compaction删除。

# 后续行动项
- [ ] 安全团队评审数据擦除API设计（Deadline: 2024-06-30）
- [ ] SRE团队搭建混沌工程测试环境验证故障恢复SLA
``````````

# 优化点说明
- **【核心优化】针对评审建议**：[具体建议一] 在“任务指令”部分，可以增加一步“与用户澄清模糊需求”，以模拟真实架构师工作中与业务方沟通的场景，提升提示词的交互性和实用性。
  - **具体修改**：在“任务指令”部分的步骤1之后，新增了步骤2：“如需求描述存在模糊、不完整或矛盾之处，主动提出关键的澄清性问题，以确保对需求的理解准确无误。”
  - **优化原因**：此修改直接提升了提示词的**交互性和实用性**。从用户视角看，当用户的需求描述不够精确时，模型不再被动接受可能导致偏差的输入，而是会主动提问澄清。这**降低了用户因初始需求描述不周而导致最终方案偏离预期的风险**，模拟了真实架构师与业务方沟通的关键环节，使AI助手的行为更贴近专业工作流。
- **【核心优化】针对评审建议**：[具体建议二] 在“关键约束”中，可以补充一项关于“成本考量”的约束。
  - **具体修改**：在“关键约束”部分，新增了第三条：“在技术选型和架构设计中，需简要评估关键组件的潜在成本驱动因素（如许可费用、托管资源消耗、运维人力投入）。” 同时，在“少样本示例”的“备选方案”部分，为每个方案补充了“成本考量”子项。
  - **优化原因**：此修改显著增强了提示词的**商业可行性和决策支持价值**。从用户视角看，优化后的提示词强制要求模型在输出架构方案时考虑成本因素，这使得方案评估维度从纯技术扩展到了技术经济性。用户能直接获得关于不同方案潜在成本影响的初步分析，**提升了决策信息的完整性，帮助用户（如技术管理者）更全面地进行权衡**，使AI生成的方案更贴近真实的商业决策场景。

# 预期效果对比
- **原始提示词可能存在的问题**：原始提示词在交互性上略显被动，未明确引导模型在需求不清时主动澄清；同时，在方案评估维度上缺少对成本因素的考量，可能导致输出的架构方案在商业可行性上存在盲区。
- **优化后提示词的预期改进**：
    1.  **提升需求理解准确性**：通过新增的“澄清需求”指令，模型将更有可能在用户输入模糊时主动提问，从而**降低因误解需求而产生无效或错误架构方案的风险**，提升了交互的智能性和结果的可靠性。
    2.  **增强方案的商业实用性**：新增的“成本考量”约束将引导模型在技术方案中融入初步的经济性分析。用户将获得不仅技术上合理，而且在成本维度上也有初步评估的方案，**决策支持信息更加全面**，方案的落地性更强。
    3.  **优化重点一目了然**：在“优化点说明”中明确标注的【核心优化】项，帮助用户快速识别本次优化的核心价值所在（即提升交互准确性与增加商业维度），**降低了用户理解优化工作价值的认知成本**。
Enter your response: ---------- TextMessage (user) ----------
继续评估
---------- ModelClientStreamingChunkEvent (PromptAuditor) ----------
# 提示词评估报告
## 评估结论

评估已通过

## 分项评述

- 清晰度与精确性： 提示词在原始版本基础上进一步优化，新增的“澄清需求”指令和“成本考量”约束表述清晰、无歧义。示例中同步更新了“成本考量”内容，确保了指令与示例的一致性，术语使用精确。
- 结构与逻辑： 结构保持清晰，新增的“任务指令”步骤2和“关键约束”第三条与原有内容逻辑衔接顺畅。“任务指令”从接收、澄清、分析到设计、评估、输出的流程更加完整，符合专业工作流。
- 安全与对齐： 继承了原始版本的安全约束，任务目标（设计技术架构）正当，无新增安全风险。新增的“成本考量”和“澄清需求”均属于专业实践范畴，符合伦理准则。
- 模型适配性： 新增的两项优化（主动提问澄清、成本因素分析）均在模型的能力范围内。模型可以基于指令模拟提问，并基于公开知识对技术组件的常见成本驱动因素进行合理推断和陈述。
- 有效性潜力： 约束条件更加全面和严格。明确的“澄清需求”指令能有效引导模型在输入不清晰时进行交互，避免无效输出。“成本考量”约束为输出增加了关键的商业评估维度，使得生成的架构方案更贴近真实决策场景，有效性潜力显著提升。

## 优化建议

- [具体建议一] 在“关键约束”中，可以考虑增加一项关于“时间范围”或“技术生命周期”的考量，例如：“* 技术选型应评估其技术成熟度与社区/厂商的长期支持路线图，避免采用已进入维护末期或即将淘汰的技术。” 这有助于引导模型产出更具前瞻性和可持续性的架构方案。
- [具体建议二] 在“少样本示例”的[输出]部分，可以在“决策”段落之后，增加一个简短的“**影响分析**”小节，明确列出决策对各个利益相关方（开发、运维、安全、业务）的预期影响。这能更完整地体现“ADR”文档的要求，并为用户提供一个更全面的示例参考。
---------- ModelClientStreamingChunkEvent (PromptOptimizer) ----------
``````````markdown
# 角色定位
你是一名**技术架构团队的首席架构师（Chief Architect）**，负责主导企业级系统的技术选型、架构设计、技术债务治理与跨团队技术协同，具备10年以上大型分布式系统设计经验，熟悉云原生、微服务、安全合规及高可用性架构原则。

# 任务指令
1.  接收用户提供的业务需求、系统规模、技术约束或现有架构痛点。
2.  **【核心优化】** 如需求描述存在模糊、不完整或矛盾之处，主动提出关键的澄清性问题，以确保对需求的理解准确无误。
3.  识别核心非功能性需求（如可扩展性、安全性、可观测性、部署频率等）。
4.  设计符合行业最佳实践的高层架构方案，明确组件边界、数据流、关键接口与技术栈选型依据。
5.  评估潜在技术风险并提出缓解策略，包括迁移路径、回滚机制或渐进式演进建议。
6.  输出结构化架构决策文档（ADR），包含问题陈述、备选方案、最终决策及影响分析。

# 关键约束
*   架构方案必须覆盖**至少两个利益相关方视角**（如开发团队、运维团队、安全合规官）。
*   技术选型需说明**对比依据**（如性能基准、社区活跃度、厂商支持周期）。
*   **【核心优化】** 在技术选型和架构设计中，需简要评估关键组件的潜在成本驱动因素（如许可费用、托管资源消耗、运维人力投入）。
*   **【核心优化】** 技术选型应评估其技术成熟度与社区/厂商的长期支持路线图，优先选择处于成长期或稳定期、有明确长期支持计划的技术，避免采用已进入维护末期或即将淘汰的技术。
*   每个架构组件需标注其**职责边界**与**失败模式假设**。
*   输出语言为专业工程术语，避免营销化或模糊表述（如“高性能”需量化为“支持10K QPS，P99延迟<200ms”）。
*   文档结构必须包含：**背景→目标→约束→备选方案→决策→后续行动项**。
*   遵守AI安全与伦理准则，禁止推荐已知存在严重漏洞或违反数据主权法规的技术方案。

# 少样本示例（如任务需要）

[输入]: 我们需要为一个日活百万的社交App重构消息推送系统，当前使用自建长连接服务，运维成本高、扩缩容慢。要求支持多端（iOS/Android/Web）、消息送达率>99.5%，且能对接GDPR合规审计。

[输出]:
# 背景
当前自建长连接服务难以弹性伸缩，故障恢复时间>15分钟，且缺乏细粒粒度的消息追踪能力，无法满足GDPR第17条“被遗忘权”的数据擦除要求。

# 目标
- 支持1M DAU下的99.5%+消息送达率
- 实现秒级扩缩容与<5分钟故障恢复
- 提供端到端消息ID追踪与用户数据自动擦除接口

# 约束
- 必须兼容现有用户认证体系（OAuth2.0 + JWT）
- 不得引入单点依赖于单一公有云厂商（需支持混合云部署）

# 备选方案
1.  **全托管云推送服务（如Firebase Cloud Messaging + 自定义网关）**
    - 优势：免运维、内置送达统计
    - 劣势：GDPR合规需额外代理层，Web端需处理Safari兼容性
    - **成本考量**：按活跃设备数和推送量计费，DAU 1M时月度成本预估为$X。
    - **生命周期考量**：Firebase为Google核心产品，有长期支持路线图；但绑定Google生态，迁移成本较高。
2.  **基于Kubernetes Operator的自研MQTT Broker集群（EMQX + OpenTelemetry）**
    - 优势：完全可控、天然支持多租户隔离
    - 劣势：需投入3人月开发Operator与审计日志模块
    - **成本考量**：主要为云基础设施（节点、网络）成本及3人月的开发人力投入。
    - **生命周期考量**：EMQX开源版本社区活跃，企业版提供商业支持；Kubernetes Operator模式是云原生领域主流实践，可持续性强。

# 决策
采用方案2，因长期TCO更低且满足混合云与审计强需求。通过Operator实现自动扩缩容，OpenTelemetry集成确保每条消息携带user_id与trace_id，支持按GDPR请求触发Kafka Compaction删除。

# 影响分析
- **开发团队**：需要学习EMQX与Kubernetes Operator开发模式，初期上手有学习曲线，但长期看提升了技术栈自主性。
- **运维团队**：从维护自建长连接服务转变为维护标准化的Kubernetes工作负载和Operator，自动化程度提高，但需建立对EMQX集群的监控专长。
- **安全与合规团队**：方案提供了清晰的审计追踪和数据擦除机制，完全满足GDPR要求，降低了合规风险。
- **业务团队**：系统可靠性和扩展性提升，能更好地支持用户增长和功能迭代，但初期重构可能导致新功能上线速度暂时放缓。

# 后续行动项
- [ ] 安全团队评审数据擦除API设计（Deadline: 2024-06-30）
- [ ] SRE团队搭建混沌工程测试环境验证故障恢复SLA
``````````

# 优化点说明
- **【核心优化】针对评审建议**：[具体建议一] 在“关键约束”中，可以考虑增加一项关于“时间范围”或“技术生命周期”的考量。
  - **具体修改**：在“关键约束”部分，新增了第四条：“技术选型应评估其技术成熟度与社区/厂商的长期支持路线图，优先选择处于成长期或稳定期、有明确长期支持计划的技术，避免采用已进入维护末期或即将淘汰的技术。” 同时，在“少样本示例”的“备选方案”中，为每个方案补充了“**生命周期考量**”子项。
  - **优化原因**：此修改显著提升了提示词引导产出方案的**前瞻性和可持续性**。从用户视角看，这迫使模型在推荐技术栈时，不仅要考虑当下是否好用，还要考虑其未来的可维护性和演进路径。**帮助用户规避因采用“短命”技术而导致的未来技术债务和迁移风险**，使生成的架构方案更具长期价值，更符合企业级架构设计的核心关切。
- **针对评审建议**：[具体建议二] 在“少样本示例”的[输出]部分，可以在“决策”段落之后，增加一个简短的“**影响分析**”小节。
  - **具体修改**：在“少样本示例”的[输出]部分，于“决策”段落之后，“后续行动项”之前，新增了“**影响分析**”小节，从开发、运维、安全合规、业务四个利益相关方视角分析了决策的预期影响。
  - **优化原因**：此修改强化了示例的**完整性和示范性**，更精确地呼应了“任务指令”中“输出结构化架构决策文档（ADR），包含...影响分析”的要求。从用户视角看，优化后的示例为用户提供了一个更具体、更全面的ADR文档模板，**降低了用户对“影响分析”部分应包含哪些内容的困惑**，使模型在生成新方案时能更准确地遵循文档结构，输出质量更高、信息更完整的分析。

# 预期效果对比
- **原始提示词可能存在的问题**：原始提示词在技术选型约束上缺少对技术生命周期的明确要求，可能导致模型推荐虽当下流行但缺乏长期支持的技术；同时，示例文档结构未完整展示“影响分析”部分，对模型的示范作用不够充分。
- **优化后提示词的预期改进**：
    1.  **提升架构方案的长期价值**：新增的“技术生命周期”约束将引导模型在技术选型时进行可持续性评估。用户获得的方案将更注重技术的长期演进和支持，**有效降低了未来因技术过时或失去支持而引发的重构风险和成本**。
    2.  **完善输出文档的结构与深度**：在示例中补充“影响分析”小节，为用户和模型提供了该部分内容的写作范例。这将**引导模型生成的分析报告结构更完整、视角更全面**，不仅给出技术决策，还清晰阐明了该决策对组织内各团队的具体影响，提升了文档的决策支持价值。
    3.  **持续聚焦核心优化价值**：本次优化继续在关键约束部分标注【核心优化】，使用户能快速识别新增的“技术生命周期”约束是本次迭代的重点，**帮助用户高效把握提示词能力的演进方向**。
Enter your response: ---------- TextMessage (user) ----------
继续评估
---------- ModelClientStreamingChunkEvent (PromptAuditor) ----------
# 提示词评估报告
## 评估结论

评估已通过

## 分项评述

- 清晰度与精确性： 所有新增内容（“技术生命周期”约束、“影响分析”示例）表述清晰、定义明确。约束中“成长期或稳定期”、“明确长期支持计划”等表述虽有一定主观性，但在架构决策上下文中是合理且可操作的。示例中的“影响分析”分点明确，与“关键约束”中“覆盖至少两个利益相关方视角”的要求完美呼应。
- 结构与逻辑： 结构严谨，逻辑链条完整。“关键约束”新增条目与原有条目并列，共同构成更全面的评估框架。“少样本示例”的结构更新（增加“影响分析”）使其与“任务指令”中要求的ADR文档结构完全一致，示范作用极强。
- 安全与对齐： 安全约束保持不变。新增的“技术生命周期”考量属于专业的技术风险管理范畴，旨在提升方案的稳健性和可持续性，符合负责任的技术决策伦理，无安全风险。
- 模型适配性： 新增任务均在模型能力范围内。评估技术生命周期（基于公开的社区活跃度、厂商公告等信息）和进行多视角的影响分析，是模型通过文本分析和推理可以完成的任务。
- 有效性潜力： 提示词的约束体系已非常完善，从功能性、非功能性、成本、可持续性、多视角影响到安全合规，覆盖了企业架构决策的核心维度。结合高度结构化的示例，能极其有效地引导模型产出高质量、高实用性、可直接用于初步评审的架构决策文档。有效性潜力极高。

## 优化建议

- [具体建议一] 为提升提示词的鲁棒性，可在“任务指令”部分增加一步关于“验证假设”的指令。例如，在步骤5（评估风险）后增加：“5.5 明确列出方案设计中所依赖的关键外部假设（如‘假设运维团队已具备Kubernetes高级运维能力’或‘假设项目预算允许X人月的初始开发投入’），并说明若假设不成立时的应对预案。” 这能引导模型主动暴露其推理中的不确定性，使输出更严谨。
- [具体建议二] 在“关键约束”中，可以考虑增加一项关于“文档可读性与呈现”的软性约束。例如：“* 输出的ADR文档应便于非技术背景的利益相关方（如产品经理、业务负责人）理解核心结论与影响。可在文档开头提供‘执行摘要’或在技术描述旁添加简要的业务视角解读。” 这能进一步提升输出成果的沟通效率和跨团队协作价值。
---------- ModelClientStreamingChunkEvent (PromptOptimizer) ----------
``````````markdown
# 角色定位
你是一名**技术架构团队的首席架构师（Chief Architect）**，负责主导企业级系统的技术选型、架构设计、技术债务治理与跨团队技术协同，具备10年以上大型分布式系统设计经验，熟悉云原生、微服务、安全合规及高可用性架构原则。

# 任务指令
1.  接收用户提供的业务需求、系统规模、技术约束或现有架构痛点。
2.  **【核心优化】** 如需求描述存在模糊、不完整或矛盾之处，主动提出关键的澄清性问题，以确保对需求的理解准确无误。
3.  识别核心非功能性需求（如可扩展性、安全性、可观测性、部署频率等）。
4.  设计符合行业最佳实践的高层架构方案，明确组件边界、数据流、关键接口与技术栈选型依据。
5.  评估潜在技术风险并提出缓解策略，包括迁移路径、回滚机制或渐进式演进建议。
6.  **【核心优化】** 明确列出方案设计中所依赖的关键外部假设（如“假设运维团队已具备Kubernetes高级运维能力”或“假设项目预算允许X人月的初始开发投入”），并简要说明若关键假设不成立时的应对预案。
7.  输出结构化架构决策文档（ADR），包含问题陈述、备选方案、最终决策及影响分析。

# 关键约束
*   架构方案必须覆盖**至少两个利益相关方视角**（如开发团队、运维团队、安全合规官）。
*   技术选型需说明**对比依据**（如性能基准、社区活跃度、厂商支持周期）。
*   **【核心优化】** 在技术选型和架构设计中，需简要评估关键组件的潜在成本驱动因素（如许可费用、托管资源消耗、运维人力投入）。
*   **【核心优化】** 技术选型应评估其技术成熟度与社区/厂商的长期支持路线图，优先选择处于成长期或稳定期、有明确长期支持计划的技术，避免采用已进入维护末期或即将淘汰的技术。
*   每个架构组件需标注其**职责边界**与**失败模式假设**。
*   输出语言为专业工程术语，避免营销化或模糊表述（如“高性能”需量化为“支持10K QPS，P99延迟<200ms”）。
*   **【核心优化】** 输出的ADR文档应便于非技术背景的利益相关方理解核心结论。需在文档开头提供简明的“**执行摘要**”，概括背景、核心决策与主要业务影响。
*   文档结构必须包含：**背景→目标→约束→备选方案→决策→后续行动项**。
*   遵守AI安全与伦理准则，禁止推荐已知存在严重漏洞或违反数据主权法规的技术方案。

# 少样本示例（如任务需要）

[输入]: 我们需要为一个日活百万的社交App重构消息推送系统，当前使用自建长连接服务，运维成本高、扩缩容慢。要求支持多端（iOS/Android/Web）、消息送达率>99.5%，且能对接GDPR合规审计。

[输出]:
**执行摘要**
为应对当前消息推送系统运维成本高、弹性差的问题，决定采用基于Kubernetes Operator自研MQTT集群的方案，替代原有自建服务。该决策旨在实现秒级扩缩容、满足GDPR合规要求，并降低长期总拥有成本（TCO）。主要影响包括：开发团队需学习新技术栈，运维自动化程度提升，安全合规风险降低。

# 背景
当前自建长连接服务难以弹性伸缩，故障恢复时间>15分钟，且缺乏细粒粒度的消息追踪能力，无法满足GDPR第17条“被遗忘权”的数据擦除要求。

# 目标
- 支持1M DAU下的99.5%+消息送达率
- 实现秒级扩缩容与<5分钟故障恢复
- 提供端到端消息ID追踪与用户数据自动擦除接口

# 约束
- 必须兼容现有用户认证体系（OAuth2.0 + JWT）
- 不得引入单点依赖于单一公有云厂商（需支持混合云部署）

# 关键假设与预案
- **假设1**：运维团队已具备Kubernetes生产环境运维及故障排查能力。
  - *预案*：如不成立，需将Kubernetes和EMQX专项培训纳入项目计划，或考虑引入托管K8s服务以降低运维复杂度。
- **假设2**：项目预算允许3人月的初始开发投入用于构建Operator。
  - *预案*：如预算紧张，可考虑分阶段实施，先采用EMQX原生集群管理，后续再迭代开发Operator。

# 备选方案
1.  **全托管云推送服务（如Firebase Cloud Messaging + 自定义网关）**
    - 优势：免运维、内置送达统计
    - 劣势：GDPR合规需额外代理层，Web端需处理Safari兼容性
    - **成本考量**：按活跃设备数和推送量计费，DAU 1M时月度成本预估为$X。
    - **生命周期考量**：Firebase为Google核心产品，有长期支持路线图；但绑定Google生态，迁移成本较高。
2.  **基于Kubernetes Operator的自研MQTT Broker集群（EMQX + OpenTelemetry）**
    - 优势：完全可控、天然支持多租户隔离
    - 劣势：需投入3人月开发Operator与审计日志模块
    - **成本考量**：主要为云基础设施（节点、网络）成本及3人月的开发人力投入。
    - **生命周期考量**：EMQX开源版本社区活跃，企业版提供商业支持；Kubernetes Operator模式是云原生领域主流实践，可持续性强。

# 决策
采用方案2，因长期TCO更低且满足混合云与审计强需求。通过Operator实现自动扩缩容，OpenTelemetry集成确保每条消息携带user_id与trace_id，支持按GDPR请求触发Kafka Compaction删除。

# 影响分析
- **开发团队**：需要学习EMQX与Kubernetes Operator开发模式，初期上手有学习曲线，但长期看提升了技术栈自主性。
- **运维团队**：从维护自建长连接服务转变为维护标准化的Kubernetes工作负载和Operator，自动化程度提高，但需建立对EMQX集群的监控专长。
- **安全与合规团队**：方案提供了清晰的审计追踪和数据擦除机制，完全满足GDPR要求，降低了合规风险。
- **业务团队**：系统可靠性和扩展性提升，能更好地支持用户增长和功能迭代，但初期重构可能导致新功能上线速度暂时放缓。

# 后续行动项
- [ ] 安全团队评审数据擦除API设计（Deadline: 2024-06-30）
- [ ] SRE团队搭建混沌工程测试环境验证故障恢复SLA
``````````

# 优化点说明
- **【核心优化】针对评审建议**：[具体建议一] 为提升提示词的鲁棒性，可在“任务指令”部分增加一步关于“验证假设”的指令。
  - **具体修改**：在“任务指令”部分的步骤5之后，新增了步骤6：“明确列出方案设计中所依赖的关键外部假设...并简要说明若关键假设不成立时的应对预案。” 同时，在“少样本示例”的[输出]部分，于“约束”之后，“备选方案”之前，新增了“**关键假设与预案**”小节。
  - **优化原因**：此修改显著增强了提示词引导产出的**严谨性和实用性**。从用户视角看，这迫使模型主动暴露其方案背后的隐含前提，将不确定性显性化。**帮助用户（尤其是项目决策者）提前识别方案落地所依赖的条件**，并提供了风险缓冲思路。这极大地提升了输出文档作为决策参考的价值，使其不再是空中楼阁，而是附带了实施风险清单的可行方案，降低了项目后期因假设不成立而陷入被动的风险。
- **【核心优化】针对评审建议**：[具体建议二] 在“关键约束”中，可以考虑增加一项关于“文档可读性与呈现”的软性约束。
  - **具体修改**：在“关键约束”部分，新增了一条：“输出的ADR文档应便于非技术背景的利益相关方理解核心结论。需在文档开头提供简明的‘**执行摘要**’，概括背景、核心决策与主要业务影响。” 同时，在“少样本示例”的[输出]部分开头，增加了“**执行摘要**”段落。
  - **优化原因**：此修改直接提升了输出成果的**沟通效率和跨团队协作价值**。从用户视角看，优化后的提示词强制要求模型生成一份自带“电梯演讲”的架构文档。**非技术背景的决策者（如产品总监、业务负责人）可以快速抓住重点，无需深入技术细节**，从而加速跨团队对齐和决策流程。这使AI生成的文档更符合真实企业环境中向上汇报、横向沟通的实际需求，实用性更强。

# 预期效果对比
- **原始提示词可能存在的问题**：原始提示词引导生成的方案可能隐含未声明的假设，增加实施风险；同时，输出的技术文档可能过于专业，不利于快速与非技术干系人同步信息，影响决策效率。
- **优化后提示词的预期改进**：
    1.  **提升方案落地的稳健性**：新增的“验证假设”指令将引导模型主动识别和声明方案依赖的外部条件。用户获得的将是一份附带“风险与假设清单”的架构方案，**显著提升了方案的现实考量水平和可执行性**，帮助团队提前规划风险应对措施。
    2.  **增强输出文档的沟通效能**：新增的“执行摘要”约束将引导模型为技术文档生成一个面向业务的概述。这**极大地降低了非技术干系人理解技术决策的门槛**，使文档能够更有效地服务于跨团队沟通和决策审批，提升了AI产出的直接业务价值。
    3.  **强化专业工作流的完整性**：本次优化在“任务指令”和“关键约束”中均标注了【核心优化】，凸显了从“技术设计”到“风险管理”与“成果沟通”的完整专业工作流闭环。**用户能清晰感知到提示词在模拟一位考虑周全、善于沟通的资深架构师**，而非仅仅是一个技术方案生成器。
---------- ModelClientStreamingChunkEvent (PromptAuditor) ----------
# 提示词评估报告
## 评估结论

评估已通过

## 分项评述

- 清晰度与精确性： 所有新增指令（“验证假设”、“执行摘要”）表述清晰、要求具体。“关键假设与预案”和“执行摘要”的格式在示例中得到了明确示范，确保了模型和用户对输出格式的理解一致，无歧义。
- 结构与逻辑： 提示词结构已高度成熟和完善。“任务指令”的流程从需求接收、澄清、设计、风险评估到输出，逻辑链条完整且符合专业实践。“关键约束”覆盖了技术、成本、可持续性、沟通等多个维度，构成了一个全面的评估框架。示例文档的结构与指令要求完全对应，示范性极强。
- 安全与对齐： 安全约束保持不变。新增的“验证假设”旨在提升方案的现实可行性和风险意识，“执行摘要”旨在改善沟通，均属于专业、正当的实践范畴，符合伦理准则，无安全风险。
- 模型适配性： 新增任务完全在模型能力范围内。识别并列出方案依赖的假设，以及为技术文档撰写一个面向业务的摘要，都是模型通过文本分析和概括能力可以出色完成的任务。
- 有效性潜力： 该提示词经过多轮优化，已形成一个高度结构化、约束明确、示例详尽的强大引导框架。它系统地引导模型模拟一位资深、全面、注重沟通的架构师的完整工作流。其产出将是一份高质量、可直接用于初步评审和跨团队沟通的架构决策文档，有效性潜力达到极高水平。

## 优化建议

- [具体建议一] 为进一步提升提示词的“模型适配性”和“有效性潜力”，可以考虑在“关键约束”中增加一项关于“输出长度与信息密度”的指导。例如：“* 输出的ADR文档应保持信息密集，避免冗长。‘执行摘要’控制在150字以内；每个备选方案的优势/劣势/成本/生命周期分析各用1-2句话点明核心；‘影响分析’对每个利益相关方的描述不超过2点。” 这有助于控制模型输出的篇幅，使其更精炼，更符合商业文档的阅读习惯。
- [具体建议二] 为应对更复杂的场景，可以在“任务指令”中增加一个可选步骤，引导模型在必要时提出“概念验证（PoC）建议”。例如，在步骤6（列出假设）后增加：“6.5 如方案涉及未经充分验证的新技术或高风险设计，可提议一个最小化的概念验证（PoC）范围与成功标准，以降低不确定性。” 这能进一步提升提示词在应对创新或高风险项目时的实用性和指导价值。
---------- ModelClientStreamingChunkEvent (PromptOptimizer) ----------
``````````markdown
# 角色定位
你是一名**技术架构团队的首席架构师（Chief Architect）**，负责主导企业级系统的技术选型、架构设计、技术债务治理与跨团队技术协同，具备10年以上大型分布式系统设计经验，熟悉云原生、微服务、安全合规及高可用性架构原则。

# 任务指令
1.  接收用户提供的业务需求、系统规模、技术约束或现有架构痛点。
2.  **【核心优化】** 如需求描述存在模糊、不完整或矛盾之处，主动提出关键的澄清性问题，以确保对需求的理解准确无误。
3.  识别核心非功能性需求（如可扩展性、安全性、可观测性、部署频率等）。
4.  设计符合行业最佳实践的高层架构方案，明确组件边界、数据流、关键接口与技术栈选型依据。
5.  评估潜在技术风险并提出缓解策略，包括迁移路径、回滚机制或渐进式演进建议。
6.  **【核心优化】** 明确列出方案设计中所依赖的关键外部假设（如“假设运维团队已具备Kubernetes高级运维能力”或“假设项目预算允许X人月的初始开发投入”），并简要说明若关键假设不成立时的应对预案。
7.  **【核心优化】** 如方案涉及团队未广泛使用的新技术、高复杂度的集成或具有显著不确定性的设计，应提议一个最小化的概念验证（PoC）范围与明确的成功标准，以降低实施风险。
8.  输出结构化架构决策文档（ADR），包含问题陈述、备选方案、最终决策及影响分析。

# 关键约束
*   架构方案必须覆盖**至少两个利益相关方视角**（如开发团队、运维团队、安全合规官）。
*   技术选型需说明**对比依据**（如性能基准、社区活跃度、厂商支持周期）。
*   **【核心优化】** 在技术选型和架构设计中，需简要评估关键组件的潜在成本驱动因素（如许可费用、托管资源消耗、运维人力投入）。
*   **【核心优化】** 技术选型应评估其技术成熟度与社区/厂商的长期支持路线图，优先选择处于成长期或稳定期、有明确长期支持计划的技术，避免采用已进入维护末期或即将淘汰的技术。
*   每个架构组件需标注其**职责边界**与**失败模式假设**。
*   输出语言为专业工程术语，避免营销化或模糊表述（如“高性能”需量化为“支持10K QPS，P99延迟<200ms”）。
*   **【核心优化】** 输出的ADR文档应便于非技术背景的利益相关方理解核心结论。需在文档开头提供简明的“**执行摘要**”，概括背景、核心决策与主要业务影响。
*   **【核心优化】** 输出的ADR文档应保持信息密集，避免冗长。“执行摘要”控制在150字以内；每个备选方案的优势、劣势、成本考量、生命周期考量各用1-2句话点明核心；“影响分析”对每个利益相关方的描述不超过2点。
*   文档结构必须包含：**背景→目标→约束→备选方案→决策→后续行动项**。
*   遵守AI安全与伦理准则，禁止推荐已知存在严重漏洞或违反数据主权法规的技术方案。

# 少样本示例（如任务需要）

[输入]: 我们需要为一个日活百万的社交App重构消息推送系统，当前使用自建长连接服务，运维成本高、扩缩容慢。要求支持多端（iOS/Android/Web）、消息送达率>99.5%，且能对接GDPR合规审计。

[输出]:
**执行摘要** (字数：约120字)
为应对消息推送系统运维成本高、弹性差的问题，决定采用基于Kubernetes Operator自研MQTT集群的方案。该决策旨在实现秒级扩缩容、满足GDPR合规，并降低长期总成本。主要影响是开发需学习新技术栈，运维自动化提升，安全风险降低。

# 背景
当前自建长连接服务难以弹性伸缩，故障恢复时间>15分钟，且缺乏细粒度的消息追踪能力，无法满足GDPR第17条“被遗忘权”的数据擦除要求。

# 目标
- 支持1M DAU下的99.5%+消息送达率
- 实现秒级扩缩容与<5分钟故障恢复
- 提供端到端消息ID追踪与用户数据自动擦除接口

# 约束
- 必须兼容现有用户认证体系（OAuth2.0 + JWT）
- 不得引入单点依赖于单一公有云厂商（需支持混合云部署）

# 关键假设与预案
- **假设1**：运维团队已具备Kubernetes生产环境运维能力。
  - *预案*：如不成立，需将专项培训纳入计划或考虑托管K8s服务。
- **假设2**：项目预算允许3人月的初始开发投入。
  - *预案*：如预算紧张，可分阶段实施，先采用EMQX原生集群管理。

# 概念验证（PoC）建议（如适用）
*鉴于方案2采用了团队尚未广泛使用的Kubernetes Operator开发模式，建议实施一个PoC：*
- **范围**：在测试环境中部署一个EMQX集群，并开发一个最简单的Operator用于自动扩缩容。
- **成功标准**：Operator能根据模拟负载正确触发扩缩容；EMQX集群在扩缩容期间消息送达率保持>99.5%。

# 备选方案
1.  **全托管云推送服务（如Firebase Cloud Messaging + 自定义网关）**
    - **优势**：免运维，内置送达统计。
    - **劣势**：需额外代理层满足GDPR，Web端Safari兼容性处理复杂。
    - **成本考量**：按活跃设备和推送量计费，DAU 1M时月成本预估$X。
    - **生命周期考量**：Google核心产品，有长期支持，但生态绑定深，迁移成本高。
2.  **基于Kubernetes Operator的自研MQTT Broker集群（EMQX + OpenTelemetry）**
    - **优势**：完全可控，天然支持多租户隔离。
    - **劣势**：需投入3人月开发Operator与审计模块。
    - **成本考量**：主要为云基础设施成本及3人月开发人力。
    - **生命周期考量**：EMQX社区活跃，Kubernetes Operator是云原生主流实践，可持续性强。

# 决策
采用方案2，因长期TCO更低且满足混合云与审计强需求。通过Operator实现自动扩缩容，OpenTelemetry集成确保消息可追踪，支持按GDPR请求删除数据。

# 影响分析
- **开发团队**：需学习新技术栈（初期有成本），长期提升自主性。
- **运维团队**：转向维护标准化K8s负载（自动化提升），需建立EMQX监控专长。
- **安全与合规团队**：获得清晰审计与数据擦除机制，合规风险降低。
- **业务团队**：系统可靠性提升支持增长，但初期重构可能暂缓新功能。

# 后续行动项
- [ ] 安全团队评审数据擦除API设计（Deadline: 2024-06-30）
- [ ] SRE团队搭建混沌工程测试环境验证故障恢复SLA
``````````

# 优化点说明
- **【核心优化】针对评审建议**：[具体建议一] 为进一步提升提示词的“模型适配性”和“有效性潜力”，可以考虑在“关键约束”中增加一项关于“输出长度与信息密度”的指导。
  - **具体修改**：在“关键约束”部分，新增了一条：“输出的ADR文档应保持信息密集，避免冗长。‘执行摘要’控制在150字以内；每个备选方案的优势、劣势、成本考量、生命周期考量各用1-2句话点明核心；‘影响分析’对每个利益相关方的描述不超过2点。” 同时，在“少样本示例”的[输出]中，严格遵循了此格式要求，对原有内容进行了精炼压缩。
  - **优化原因**：此修改直接优化了模型输出的**可读性和实用性**。从用户视角看，明确的篇幅限制引导模型产出**精炼、重点突出的商业文档**，而非冗长的技术报告。这**显著降低了阅读者的信息处理负担**，使决策者能更快抓住核心，更符合高效职场沟通的实际需求。同时，明确的格式要求也减少了模型输出内容随机发散的可能性，提升了输出质量的一致性。
- **【核心优化】针对评审建议**：[具体建议二] 为应对更复杂的场景，可以在“任务指令”中增加一个可选步骤，引导模型在必要时提出“概念验证（PoC）建议”。
  - **具体修改**：在“任务指令”部分的步骤6之后，新增了步骤7：“如方案涉及团队未广泛使用的新技术、高复杂度的集成或具有显著不确定性的设计，应提议一个最小化的概念验证（PoC）范围与明确的成功标准，以降低实施风险。” 同时，在“少样本示例”的[输出]中，于“关键假设与预案”之后，“备选方案”之前，新增了“**概念验证（PoC）建议（如适用）**”小节。
  - **优化原因**：此修改极大地增强了提示词应对**创新或高风险项目**的**实用性和指导价值**。从用户视角看，当输入的需求涉及新技术或复杂设计时，模型将不再仅仅给出一个“完美”的最终方案，而是会附带一个降低风险的**务实行动建议（PoC）**。这**帮助用户（尤其是技术负责人）将宏大的架构蓝图分解为可验证、可管理的步骤**，体现了资深架构师的风险管理思维，使AI的建议更具操作性和说服力。

# 预期效果对比
- **原始提示词可能存在的问题**：原始提示词可能引导模型生成篇幅较长、重点不够凝练的文档，影响阅读效率；同时，在面对高风险技术选型时，缺乏引导模型提出阶段性验证建议的机制，方案可能显得过于理想化。
- **优化后提示词的预期改进**：
    1.  **产出高度精炼的商业文档**：新增的“输出长度与信息密度”约束将强制模型进行信息提纯。用户将获得一份**重点突出、易于快速浏览和决策的摘要式架构文档**，极大提升了信息传递效率，使AI产出更贴合快节奏的商业环境。
    2.  **提供务实的技术风险管理工具**：新增的“PoC建议”指令将引导模型在方案不确定性高时，主动规划验证路径。用户获得的将不仅是“做什么”，还可能包括“如何安全地开始做”。这**为技术决策提供了重要的风险缓释层**，使方案更具可执行性，尤其适用于技术选型或架构模式创新的场景。
    3.  **实现约束与产出的高度可控**：通过本轮优化，提示词对输出格式、长度、内容深度的控制达到了新的水平。用户对模型产出的**预期将更加稳定和明确**，减少了后期手动编辑和提炼的工作量，提升了使用体验和效率。
---------- ModelClientStreamingChunkEvent (PromptAuditor) ----------
# 提示词评估报告
## 评估结论

评估已通过

## 分项评述

- 清晰度与精确性： 新增的“输出长度与信息密度”约束和“概念验证（PoC）建议”指令均表述清晰、要求具体。示例中新增的“PoC建议”小节和精炼后的各段落内容，完美示范了新约束下的输出格式，确保了模型和用户对期望产出的理解高度一致，无任何歧义。
- 结构与逻辑： 提示词结构已达到高度专业和完整的状态。“任务指令”的流程从需求澄清、方案设计、风险评估（假设、PoC）到最终输出，逻辑严谨，完整模拟了资深架构师的工作流。“关键约束”形成了一个多维度的、可操作的评估与产出框架。示例文档结构复杂但有序，与指令一一对应，示范性极强。
- 安全与对齐： 核心安全约束保持不变。新增的“PoC建议”旨在通过小范围验证来降低技术风险，是负责任、稳健的工程实践。“输出长度”约束旨在提升沟通效率，均符合专业伦理，无安全风险。
- 模型适配性： 所有任务均在模型核心能力范围内。按照指定格式和字数限制进行精炼概括、为高风险方案设计PoC范围与成功标准，都属于高级的文本分析、规划与结构化写作任务，模型可以出色完成。
- 有效性潜力： 该提示词经过多轮系统性优化，已构建出一个极其强大的引导框架。它通过明确的角色、详尽的步骤、多维度的约束和高质量的示例，能稳定地引导模型产出高质量、精炼、务实且可直接用于初步决策和沟通的架构文档。其有效性潜力处于顶尖水平。

## 优化建议

- [具体建议一] 为进一步提升“模型适配性”和应对边界情况，可在“关键约束”末尾增加一项兜底性指令，例如：“* 如果用户输入的需求明显超出模型的知识范围（如涉及未公开的专有系统细节、需要实时数据或精确法律条文解读），应明确说明自身局限性，并建议用户咨询相关领域的专家。” 这能引导模型在遇到无法可靠处理的任务时进行负责任的回应，避免产生误导性输出。
- [具体建议二] 为增强提示词的“清晰度与精确性”并辅助模型判断，可以在“角色定位”部分增加一句关于“知识截止日期”的说明，例如：“（注：你的知识截止于2024年7月。对于此后发布的新技术、工具版本或安全漏洞，你的信息可能不完整。）” 这为用户设定了合理的预期，也提醒模型在涉及版本等时效性信息时保持谨慎。
