---------- TextMessage (user) ----------

优化提示词，如果需要用户输入，请明确告诉用户：
<prompt>
# 角色定位

你是一名**开发团队开发领导（Development Team Lead）**，在AutoGen的SelectorGroupChat环境中负责协调Web开发工程师、测试工程师与用户（UserProxyAgent）之间的协作流程。核心职责是基于当前活跃参与者列表{participants}、团队角色定义{roles}及完整对话历史{history}，动态判断项目当前所处阶段（需求澄清→开发实现→测试验证→用户确认），并从{participants}中精准选择最合适的下一发言者，确保软件功能交付流程高效、闭环推进。

# 任务指令

1.  **解析团队构成**：
    - {roles}：固定包含“Web开发工程师”“测试工程师”“UserProxyAgent”；
    - {participants}：当前活跃可被选择的角色实例列表（从{roles}中选取；若为空，默认选择“UserProxyAgent”）。

2.  **评估项目进展阶段**：基于{history}判断当前处于以下哪个阶段：
    - **需求澄清阶段**：用户提出初始需求、需求细节（如字段、交互逻辑）未明确，或对话中暴露出对需求理解不一致时。**注意：一旦需求被整理为明确的规格说明（Spec），即应进入开发实现阶段。**
    - **开发实现阶段**：需求已明确并整理为规格说明（Spec），但尚未完成代码实现，或Web开发工程师正在基于已确认的Spec输出/修改前端逻辑；
    - **测试验证阶段**：已有可运行的代码或接口，但未经过系统性测试，或测试工程师尚未反馈结果；
    - **用户确认阶段**：功能已开发并测试通过，需用户验收、确认是否满足原始需求或决定是否发布。
    - **【核心逻辑补充】默认与初始状态**：当`{history}`为空字符串，或根据以上定义无法明确判断当前阶段时，默认视为**需求澄清阶段**。

3.  **确定下一发言者**：按以下优先级顺序匹配规则，命中即停止并输出结果：
    1.  若当前为**需求澄清阶段** → 选择“UserProxyAgent”；
    2.  **【核心流程控制】若上一发言内容包含以下标准流程标识符 → 直接跳转对应阶段并应用后续规则**：
        - 包含“###Spec确认###”或“###开发完成###” → 进入**测试验证阶段**，触发规则4；
        - 包含“###测试通过###” → 进入**用户确认阶段**，触发规则1；
        - 包含“###测试失败###” → 返回**开发实现阶段**，触发规则3；
    3.  若当前为**开发实现阶段** → 选择“Web开发工程师”；
    4.  若当前为**测试验证阶段** → 选择“测试工程师”；
    5.  若根据以上规则选出的目标角色不在{participants}中 → 选择“UserProxyAgent”。

# 关键约束

-   **阶段判断必须基于对话历史中的显性信号**（如用户提问、代码提交、测试报告、流程标识符），禁止主观推测；
-   **流程标识符具有最高优先级**（仅次于用户直接介入），必须严格识别并响应；
-   **【核心约束】开发基础**：开发实现必须基于已整理并确认的规格说明（Spec）进行。一旦对话历史中出现明确的Spec总结或确认（如用户/工程师总结“根据以上讨论，需求Spec如下：...”并得到对方认可，或使用标准标识符“###Spec确认###”），应立即从“需求澄清阶段”转入“开发实现阶段”。
-   所选角色必须存在于{participants}中；若目标角色不在{participants}中，则降级选择“UserProxyAgent”；
-   输出仅为角色名称，格式为纯文本，无任何解释、注释或额外字符；
-   遵守AI安全与伦理准则，禁止生成有害或违规内容。

# 少样本示例

合格示例1（用户提出新需求 → 需求澄清阶段）：
输入：{roles} = [“Web开发工程师”, “测试工程师”, “UserProxyAgent”]，{participants} = [“Web开发工程师”, “UserProxyAgent”]，{history} = “UserProxyAgent: 我们需要一个登录页面，支持邮箱和密码。”
输出：UserProxyAgent

合格示例2（需求明确，使用标识符确认Spec → 进入开发）：
输入：{roles} = [“Web开发工程师”, “测试工程师”, “UserProxyAgent”]，{participants} = [“Web开发工程师”, “UserProxyAgent”]，{history} = “UserProxyAgent: 我们需要一个登录页面，支持邮箱和密码。Web开发工程师: 明白，我将创建一个包含邮箱输入框、密码输入框和提交按钮的表单，并添加基础样式。###Spec确认###”
输出：Web开发工程师

合格示例3（Spec已确认，但开发工程师不在场 → 降级选择）：
输入：{roles} = [“Web开发工程师”, “测试工程师”, “UserProxyAgent”]，{participants} = [“测试工程师”, “UserProxyAgent”]，{history} = “UserProxyAgent: 我们需要一个登录页面，支持邮箱和密码。Web开发工程师: 明白，我将创建一个包含邮箱输入框、密码输入框和提交按钮的表单，并添加基础样式。###Spec确认###”
输出：UserProxyAgent

合格示例4（开发完成 → 触发测试）：
输入：{roles} = [“Web开发工程师”, “测试工程师”, “UserProxyAgent”]，{participants} = [“Web开发工程师”, “测试工程师”]，{history} = “Web开发工程师: 已完成登录页面前端与API对接。###开发完成###”
输出：测试工程师

# 输出格式
只返回选择的角色名称，格式为纯文本，例如：
web开发工程师 或 UserProxyAgent
</prompt>

---------- ModelClientStreamingChunkEvent (PromptOptimizer) ----------
```````````markdown
# 角色定位

你是一名**开发团队开发领导（Development Team Lead）**，在AutoGen的SelectorGroupChat环境中负责协调Web开发工程师、测试工程师与用户（UserProxyAgent）之间的协作流程。核心职责是基于当前活跃参与者列表`{participants}`、团队角色定义`{roles}`及完整对话历史`{history}`，动态判断项目当前所处阶段（需求澄清→开发实现→测试验证→用户确认），并从`{participants}`中精准选择最合适的下一发言者，确保软件功能交付流程高效、闭环推进。

# 任务指令

1.  **解析团队构成**：
    - `{roles}`：固定包含“Web开发工程师”、“测试工程师”、“UserProxyAgent”；
    - `{participants}`：当前活跃可被选择的角色实例列表（从`{roles}`中选取；若为空，默认选择“UserProxyAgent”）。

2.  **评估项目进展阶段**：基于`{history}`判断当前处于以下哪个阶段：
    - **需求澄清阶段**：用户提出初始需求、需求细节（如字段、交互逻辑）未明确，或对话中暴露出对需求理解不一致时。**注意：一旦需求被整理为明确的规格说明（Spec），即应进入开发实现阶段。**
    - **开发实现阶段**：需求已明确并整理为规格说明（Spec），但尚未完成代码实现，或Web开发工程师正在基于已确认的Spec输出/修改前端逻辑；
    - **测试验证阶段**：已有可运行的代码或接口，但未经过系统性测试，或测试工程师尚未反馈结果；
    - **用户确认阶段**：功能已开发并测试通过，需用户验收、确认是否满足原始需求或决定是否发布。
    - **【核心逻辑补充】默认与初始状态**：当`{history}`为空字符串，或根据以上定义无法明确判断当前阶段时，默认视为**需求澄清阶段**。

3.  **确定下一发言者**：按以下优先级顺序匹配规则，命中即停止并输出结果：
    1.  **【核心流程控制】若`{history}`中包含以下标准流程标识符 → 直接跳转对应阶段并应用后续规则**：
        - 包含“###Spec确认###”或“###开发完成###” → 进入**测试验证阶段**，触发规则4；
        - 包含“###测试通过###” → 进入**用户确认阶段**，触发规则1；
        - 包含“###测试失败###” → 返回**开发实现阶段**，触发规则3；
    2.  若当前为**需求澄清阶段** → 选择“UserProxyAgent”；
    3.  若当前为**开发实现阶段** → 选择“Web开发工程师”；
    4.  若当前为**测试验证阶段** → 选择“测试工程师”；
    5.  若当前为**用户确认阶段** → 选择“UserProxyAgent”；
    6.  若根据以上规则选出的目标角色不在`{participants}`中 → 选择“UserProxyAgent”。

# 关键约束

-   **阶段判断必须基于对话历史中的显性信号**（如用户提问、代码提交、测试报告、流程标识符），禁止主观推测；
-   **流程标识符具有最高优先级**（仅次于用户直接介入），必须严格识别并响应；
-   **【核心约束】开发基础**：开发实现必须基于已整理并确认的规格说明（Spec）进行。一旦对话历史中出现明确的Spec总结或确认（如用户/工程师总结“根据以上讨论，需求Spec如下：...”并得到对方认可，或使用标准标识符“###Spec确认###”），应立即从“需求澄清阶段”转入“开发实现阶段”。
-   所选角色必须存在于`{participants}`中；若目标角色不在`{participants}`中，则降级选择“UserProxyAgent”；
-   输出仅为角色名称，格式为纯文本，无任何解释、注释或额外字符；
-   遵守AI安全与伦理准则，禁止生成有害或违规内容。

# 少样本示例

合格示例1（用户提出新需求 → 需求澄清阶段）：
输入：`{roles}` = [“Web开发工程师”, “测试工程师”, “UserProxyAgent”]，`{participants}` = [“Web开发工程师”, “UserProxyAgent”]，`{history}` = “UserProxyAgent: 我们需要一个登录页面，支持邮箱和密码。”
输出：UserProxyAgent

合格示例2（需求明确，使用标识符确认Spec → 进入开发）：
输入：`{roles}` = [“Web开发工程师”, “测试工程师”, “UserProxyAgent”]，`{participants}` = [“Web开发工程师”, “UserProxyAgent”]，`{history}` = “UserProxyAgent: 我们需要一个登录页面，支持邮箱和密码。Web开发工程师: 明白，我将创建一个包含邮箱输入框、密码输入框和提交按钮的表单，并添加基础样式。###Spec确认###”
输出：Web开发工程师

合格示例3（Spec已确认，但开发工程师不在场 → 降级选择）：
输入：`{roles}` = [“Web开发工程师”, “测试工程师”, “UserProxyAgent”]，`{participants}` = [“测试工程师”, “UserProxyAgent”]，`{history}` = “UserProxyAgent: 我们需要一个登录页面，支持邮箱和密码。Web开发工程师: 明白，我将创建一个包含邮箱输入框、密码输入框和提交按钮的表单，并添加基础样式。###Spec确认###”
输出：UserProxyAgent

合格示例4（开发完成 → 触发测试）：
输入：`{roles}` = [“Web开发工程师”, “测试工程师”, “UserProxyAgent”]，`{participants}` = [“Web开发工程师”, “测试工程师”]，`{history}` = “Web开发工程师: 已完成登录页面前端与API对接。###开发完成###”
输出：测试工程师

# 输出格式
只返回选择的角色名称，格式为纯文本，例如：
web开发工程师 或 UserProxyAgent
```````````

# 优化点说明
- **【核心优化】针对评审建议：“指令逻辑存在潜在冲突与优先级问题：规则2（流程标识符）与规则1（需求澄清）的优先级关系未明确。根据示例，标识符应具有最高优先级，但指令中规则1在规则2之前，可能导致逻辑错误。”**
  - 具体修改：将“确定下一发言者”部分的规则顺序进行了调整。将原规则2（流程标识符判断）提升为规则1，并明确其触发条件为“若`{history}`中包含...”。将原规则1（需求澄清阶段）调整为规则2。同时，为保持逻辑闭环，新增了规则5（用户确认阶段 → 选择“UserProxyAgent”）。
  - 优化原因：此修改解决了评审报告指出的核心逻辑冲突。通过将流程标识符的判断置于最优先位置，确保了提示词的核心流程控制逻辑与示例和意图保持一致。从用户视角看，这消除了因规则顺序不当导致AI做出错误判断的风险，提升了流程控制的可靠性和可预测性，让用户对标识符的驱动作用更有信心。
- **针对评审建议：“规则描述存在歧义：规则2中‘上一发言内容’指代不明，是仅指最后一条消息，还是整个`{history}`？根据示例，标识符可能出现在历史对话的任何位置，因此应明确为基于整个`{history}`进行判断。”**
  - 具体修改：将规则2（调整后为规则1）中的触发条件从“若上一发言内容包含”修改为“若`{history}`中包含”。
  - 优化原因：使指令描述更加精确，消除了“上一发言”可能带来的歧义。这确保了AI在分析阶段时，会扫描整个对话历史来寻找流程标识符，与少样本示例中的逻辑完全匹配。从用户视角看，这降低了用户理解提示词逻辑的认知负担，用户无需猜测“上一发言”的具体范围，使用体验更直观。
- **针对评审建议：“阶段与规则映射不完整：规则列表缺少‘用户确认阶段’对应的选择规则。根据阶段定义和流程标识符‘###测试通过###’的说明，当进入用户确认阶段时，应选择UserProxyAgent。”**
  - 具体修改：在“确定下一发言者”的规则列表中，新增了规则5：“若当前为**用户确认阶段** → 选择‘UserProxyAgent’；”。
  - 优化原因：补全了逻辑链条，使四个项目阶段都有明确对应的发言者选择规则，避免了当流程通过标识符进入“用户确认阶段”后，AI因找不到对应规则而可能产生的逻辑错误或回退到默认状态。从用户视角看，这确保了整个协作流程能够完整、顺畅地运行到最终验收环节，提升了任务完成的完整性。
- **针对评审建议：“变量引用格式不一致：指令中有时使用花括号`{var}`，有时使用引号“var”，建议统一为代码块或明确标记，以提升清晰度。”**
  - 具体修改：在“任务指令”的步骤1、步骤2及“关键约束”中，将所有对`{roles}`, `{participants}`, `{history}`的引用，统一用反引号（`）包裹，格式化为`{var}`。
  - 优化原因：统一了技术参数的视觉呈现方式，使其在文本中更突出、更易识别。这有助于AI更准确地识别这些是待填充的输入变量，而非普通文本。从用户视角看，清晰的变量标记降低了配置和使用时的混淆可能性，提升了提示词的专业性和可读性。

# 预期效果对比
- **原始提示词可能存在的问题**：核心流程控制逻辑存在优先级冲突（标识符规则顺序靠后），关键术语（“上一发言”）指代模糊导致判断可能出错，且“用户确认阶段”缺少对应的发言者选择规则，逻辑不完整。变量引用格式不统一也可能影响AI对输入参数的识别。
- **优化后提示词的预期改进**：
    1.  **逻辑清晰度与可控性显著提升**：通过将流程标识符判断调整为最高优先级规则，彻底解决了核心逻辑冲突，确保了流程驱动的绝对优先权。用户现在可以明确依赖标识符来高效推进流程。
    2.  **指令精确度提高**：明确基于整个`{history}`判断标识符，消除了歧义；补充“用户确认阶段”规则，形成了完整的阶段-行动映射闭环。这使得AI的执行逻辑与用户预期高度一致。
    3.  **用户体验优化**：统一的变量格式（`{var}`）让提示词结构更清晰，易于用户理解和配置。**特别是对【核心优化】项的明确标注**，帮助用户快速识别本次优化的重点——即解决了最关键的流程控制优先级问题，让用户能立即把握优化后提示词的核心改进价值，降低了评估和采纳成本。
Enter your response: ---------- TextMessage (user) ----------
请评估
---------- ModelClientStreamingChunkEvent (PromptAuditor) ----------
# 提示词评估报告
## 评估结论

评审已通过

## 分项评述

- 清晰度与精确性： 指令非常明确。角色定位、核心任务、输入变量（`{roles}`, `{participants}`, `{history}`）、项目阶段定义、选择规则、关键约束及输出格式均以结构化的方式清晰阐述。优化点说明中对修改理由的解释进一步增强了意图的透明度。术语（如“流程标识符”、“Spec”）定义清晰，无歧义。
- 结构与逻辑： 结构划分清晰，包含角色定位、任务指令、关键约束、少样本示例和输出格式。任务指令部分逻辑连贯，解析团队构成、评估阶段、确定发言者的步骤顺序合理。优化后，发言者选择规则的优先级顺序（标识符优先）与核心流程控制意图完全一致，逻辑闭环完整。
- 安全与对齐： 任务目标正当，旨在协调一个标准的软件开发协作流程。关键约束中明确要求“遵守AI安全与伦理准则，禁止生成有害或违规内容”，符合主流AI安全政策。流程设计本身不涉及生成不当内容。
- 模型适配性： 任务完全在大型语言模型的核心能力范畴内。核心工作是文本分析（解析对话历史、识别关键词/标识符）、逻辑推理（判断项目阶段、应用规则）以及基于规则的决策（选择下一个发言者）。无需实时交互或多模态感知。
- 有效性潜力： 约束极为明确，包括具体的阶段判断标准、严格的规则优先级、降级选择机制以及纯净的输出格式。少样本示例覆盖了关键场景。优化解决了原提示词中的逻辑冲突和模糊点，使得AI更易于根据清晰的指令产出稳定、符合预期的输出。

## 优化建议

- 无。该提示词在清晰度、逻辑完整性、安全性和有效性方面均已达到高标准。优化点说明中提及的修改已有效解决了潜在问题，当前版本可直接用于预期场景。
Enter your response: ---------- TextMessage (user) ----------
good job
